# Whisper Bot

Telegram-бот для транскрипции голосовых сообщений с использованием OpenAI Whisper.

## Возможности

- Автоматическая транскрипция голосовых сообщений в групповых чатах
- Поддержка круглых видео (video notes)
- GPU-ускорение через Apple MPS (Apple Silicon) или CUDA
- Reply на оригинальное сообщение с текстом транскрипции

## Требования

- Python 3.10+
- FFmpeg (`brew install ffmpeg`)
- [whisper-cli](../whisper-cli) — локальная зависимость
- [go-task](https://taskfile.dev/) — для управления ботом

## Установка

```bash
# Установка зависимостей
task install

# Создание .env файла
task env

# Отредактировать .env, добавить BOT_TOKEN от @BotFather
```

## Конфигурация

Переменные окружения (`.env`):

| Переменная | Описание | По умолчанию |
|------------|----------|--------------|
| `BOT_TOKEN` | Токен бота от @BotFather | *обязательно* |
| `ALLOWED_CHATS` | Разрешённые чаты (через запятую) | *обязательно* |
| `WHISPER_MODEL` | Модель Whisper (tiny/base/small/medium/large) | `medium` |
| `WHISPER_LANGUAGE` | Язык распознавания | `ru` |

### Получение Chat ID

Добавьте [@getmyid_bot](https://t.me/getmyid_bot) в группу — он покажет ID чата (отрицательное число вида `-100...`).

## Управление

```bash
task start      # Запуск бота в фоне
task stop       # Остановка
task restart    # Перезапуск
task status     # Статус (running/not running)
task logs       # Просмотр логов (live)
task logs:last  # Последние 50 строк логов
task logs:clear # Очистка логов
```

## Использование

1. Создать бота через [@BotFather](https://t.me/BotFather)
2. Добавить бота в групповой чат
3. Получить ID чата через [@getmyid_bot](https://t.me/getmyid_bot)
4. Добавить ID в `ALLOWED_CHATS` в `.env`
5. Дать боту права на чтение сообщений (или сделать админом)
6. Отправить голосовое сообщение — бот ответит транскрипцией

## Структура

```
whisper-bot/
├── pyproject.toml          # Зависимости и метаданные
├── Taskfile.yml            # Команды управления
├── .env.example            # Шаблон конфигурации
└── src/whisper_bot/
    ├── __init__.py
    ├── config.py           # Загрузка конфигурации
    └── bot.py              # Логика бота
```

## Модели Whisper

| Модель | Размер | Качество | Скорость |
|--------|--------|----------|----------|
| tiny | 39MB | Низкое | Очень быстро |
| base | 74MB | Базовое | Быстро |
| small | 244MB | Хорошее | Средне |
| **medium** | 769MB | Отличное | Средне |
| large | 1.5GB | Максимальное | Медленно |

Рекомендуется `medium` для русского языка — оптимальный баланс качества и скорости.
